<div>
  <div class="bg-light ps-2 mt-3 rounded-top">
    <h4>
      Загрузить документ
    </h4>
    <hr class="my-1">
    <form id="upload_form" class="pb-1" action="upload" method="post" enctype="multipart/form-data">
      <label class="d-block">Название
        <input type="text" name="title" class="d-block mb-1">
      </label>
      <label class="d-block">Комментарий
        <textarea name="comment" class="d-block mb-1" cols="50" rows="10"></textarea>
      </label>
      <input type="file" name="document" class="btn btn-outline-dark d-block mb-1">
      <div id="dop_files">
        
      </div>
      <button id="add_file" type="button" class="btn btn-outline-dark d-block">Дополнительный файл</button>
      <input type="submit" id="upload_submit" value="Загрузить" class="btn btn-outline-dark d-block">
    </form>
  </div>


  {{range .User.Roles}}
    {{if (eq . "user")}}
      <div class="bg-light mt-3 ps-2">
        <h4>
          Ваши документы
        </h4>
        <hr class="my-1">
        <div id="mydocs_tags" class="pb-1">
          
        </div>
        <hr class="my-1">
        <div id="mydocs" class="pb-1">
    
        </div>
      </div>
    {{end}}

    {{if (eq . "head")}}
      <div class="bg-light mt-3 ps-2">
        <h4>
          Активные документы
        </h4>
        <hr class="my-1">
        <div id="headdocs" class="pb-1">
    
        </div>
      </div>
      <div class="bg-light mt-3 ps-2">
        <h4>
          Архивные документы
        </h4>
        <hr class="my-1">
        <div id="headarch" class="pb-1">
    
        </div>
      </div>
    {{end}}
  {{end}}
  

  <script>
    $("#add_file").click(function(event){
      $("#dop_files").append('<div class="d-block"><input type="file" name="document" class="btn btn-outline-dark mb-1"><button type="button" class="file_delete btn btn-outline-dark">X</button></div>');
      handle_docs();
    });
    function handle_docs() {
      $(".file_delete").click(function(){
        $(this).parent().remove();
      });
    }


    $(document).ready(function(){
      loadDocs("/tags","mydocs_tags");
      loadDocs("/actual_docs","mydocs");
      loadDocs("/head_docs","headdocs");
      loadDocs("/head_archive","headarch");
    });

    $("#upload_form").submit(function(event){
      event.preventDefault();
      var reject = false;
      $("#upload_form").find("input").each(function(i,j){
        if ($(this).val() == '') {
          reject = true;
        }
      });
      if (reject == true) {
        handle_error("Не введены данные");
        return;
      }
      
      var data = new FormData($("#upload_form")[0])
      $.ajax({
        type: 'POST',
        url: 'upload',
        enctype: 'multipart/form-data',
        processData: false,
        contentType: false,
        data: data,
        error: function(result) {
          if (xhr == "Unauthorized") {
            window.location.replace("/login");
            return;
          }
          handle_error(result.responseText);
        },
        success: function(result) {
          handle_success("Документ успешно загружен");
          location.reload();
        }
      });
    });

    function loadDocs(path, id) {
      $.ajax({
        url: path,
        type: "GET",
        //data: JSON.stringify(data),
        success: function (result,status,xhr) {
          document.getElementById(id).innerHTML = result
        },
        error: function(result,status,xhr) {
          console.log(xhr);
          if (xhr == "Unauthorized") {
            window.location.replace("/login");
          }
        }
      });
    }
  </script>
</div>